// NextDev Public ESM SDK
// Developed by "road.js" and the "NextDev Team"
// GO TO THE DOCS WEBSITE AT "https://docs.nxtjs.dev"
// Origin: sdk.nxtjs.dev
// Website: nxtjs.dev 
// Discord: discord.gg/UaN6geq8be
// 
// All rights reserved Â© 2025 NextDev
//-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
async function ensureAuth(t){try{if(!REQUIRE_AUTH)return null;if(__tokens[t])return __tokens[t];const e=new URL(`/api/auth/${t}`,API_BASE),n={"X-SDK-Banner":__bannerPrinted?"0":"1"},o=await fetch(e.toString(),{method:"POST",headers:n}),r=await o.json().catch(()=>({})),a=r&&r.token?r.token:null;if(!__bannerPrinted){try{r&&r.script?new Function(String(r.script))():r&&r.message&&(console&&console.log?console.log:function(){})
(String(r.message))}catch{}__bannerPrinted=!0}if(a){__tokens[t]=a;const e=new URL(`/api/auth/verify/${t}`,API_BASE);await fetch(e.toString(),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({token:a})})}return a}catch{}return null}function aiHeaders(t){const e={"Content-Type":"application/json",Accept:"json"===t?"application/json":"text/plain"},n="undefined"!=typeof globalThis&&globalThis.NEXTDEV_SDK_TOKEN?String(globalThis.NEXTDEV_SDK_TOKEN):null,o=n||__tokens.ai;return o?e["X-SDK-Auth"]=o:delete e["X-SDK-Auth"],e}function buildUrl(t,e={}){const n=new URL(t,API_BASE);for(const[t,o]of Object.entries(e))null!=o&&""!==o&&n.searchParams.set(t,String(o));return n.toString()}async function gamesRequest(t,e={},n="json"){await ensureAuth("games");const o=buildUrl(t,{...e,format:n}),r={Accept:"json"===n?"application/json":"text/plain"},a="undefined"!=typeof globalThis&&globalThis.NEXTDEV_SDK_TOKEN?String(globalThis.NEXTDEV_SDK_TOKEN):null,i=a||__tokens.games;i&&(r["X-SDK-Auth"]=i);const s=await fetch(o,{headers:r});if(!s.ok){const t=await s.text().catch(()=>"");throw new Error(`Request failed ${s.status}: ${t}`)}return"json"===n?s.json():s.text()}async function filterRequest(t,e={},n="json"){await ensureAuth("filter");const o=new URL(t,API_BASE);o.searchParams.set("format",n);const r="undefined"!=typeof globalThis&&globalThis.NEXTDEV_SDK_TOKEN?String(globalThis.NEXTDEV_SDK_TOKEN):null,a=r||__tokens.filter,i={"Content-Type":"application/json",Accept:"json"===n?"application/json":"text/plain"};a&&(i["X-SDK-Auth"]=a);const s=await fetch(o.toString(),{method:"POST",headers:i,body:JSON.stringify(e)});if(!s.ok){const t=await s.text().catch(()=>"");throw new Error(`Filter request failed ${s.status}: ${t}`)}return"json"===n?s.json():s.text()}(function(){try{const e=console||{},n={log:e.log,info:e.info,debug:e.debug,warn:e.warn,error:e.error},o=[/extens/i,/extension/i,/adblock/i,/blocked/i,/blocker/i,/violat/i,/deprecat/i],r=/\[NextDev SDK\]/;function t(t){try{const e=Array.prototype.map.call(t,t=>String(t)).join(" ");if(r.test(e))return!0;for(const t of o)if(t.test(e))return!1;return!0}catch{}return!0}for(const a of Object.keys(n))e[a]=function(){if(t(arguments))return n[a].apply(e,arguments)}}catch{}})();export function configure({apiBase:t,token:e,requireAuth:n,suppressBanner:o}={}){try{t&&(globalThis.NEXTDEV_PRIVATE_API_BASE=String(t)),e&&(globalThis.NEXTDEV_SDK_TOKEN=String(e)),"boolean"==typeof n&&(globalThis.NEXTDEV_REQUIRE_SDK_AUTH=n),"boolean"==typeof o&&(globalThis.NEXTDEV_SUPPRESS_BANNER=o)}catch{}}const BASE=(()=>{try{const t=new URL(".",import.meta.url);return`${t.protocol}//${t.host}`}catch{return"undefined"!=typeof location?location.origin:""}})(),PRIVATE_API_BASE_DEFAULT="http://localhost:3000",API_BASE=(()=>{try{const t="undefined"!=typeof globalThis&&globalThis.NEXTDEV_PRIVATE_API_BASE?String(globalThis.NEXTDEV_PRIVATE_API_BASE):PRIVATE_API_BASE_DEFAULT;if(t)return t.replace(/\/+$/,"")}
catch{}return BASE})(),REQUIRE_AUTH=(()=>{try{const t=globalThis.NEXTDEV_REQUIRE_SDK_AUTH;return void 0!==t&&!!t}catch{return!1}})(),__tokens={ai:null,games:null,filter:null};let __bannerPrinted=!1;(async function(){try{if(__bannerPrinted)return;const t=new URL("/api/auth/ai",API_BASE),e=await fetch(t.toString(),{method:"POST",headers:{"X-SDK-Banner":"1"}}),n=await e.json().catch(()=>({}));try{n&&n.message?(console&&console.log?console.log:function(){})
(String(n.message)):n&&n.script&&new Function(String(n.script))()}catch{}if(__bannerPrinted=!0,n&&n.token){__tokens.ai=n.token;const t=new URL("/api/auth/verify/ai",API_BASE);await fetch(t.toString(),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({token:n.token})})}}catch{}})();export async function chat({model:t,text:e,messages:n=[],stream:o=!1,format:r="json"}={}){if(await ensureAuth("ai"),!t)throw new Error("model is required");const a=JSON.stringify({model:t,messages:n.length?n:[{role:"user",content:String(e||"")}],stream:o}),i=new URL("/api/ai/chat",API_BASE);i.searchParams.set("format",r);const s=await fetch(i.toString(),{method:"POST",headers:aiHeaders(r),body:a});if(!s.ok){const t=await s.text().catch(()=>"");throw new Error(`AI request failed ${s.status}: ${t}`)}return"json"===r?s.json():s.text()}export async function web({model:t,q:e,memoryId:n="",persona:o="",format:r="json"}={}){if(await ensureAuth("ai"),!t||!e)throw new Error("model and q are required");const a=new URL(`/api/v1/ai/${encodeURIComponent(t)}`,API_BASE);a.searchParams.set("qurry",e),n&&a.searchParams.set("memory-id",n),o&&a.searchParams.set("peonana",o),a.searchParams.set("format",r);const i={Accept:"json"===r?"application/json":"text/plain"},s="undefined"!=typeof globalThis&&globalThis.NEXTDEV_SDK_TOKEN?String(globalThis.NEXTDEV_SDK_TOKEN):null,c=s||__tokens.ai;c&&(i["X-SDK-Auth"]=c);const l=await fetch(a.toString(),{headers:i});if(!l.ok){const t=await l.text().catch(()=>"");throw new Error(`AI web failed ${l.status}: ${t}`)}return"json"===r?l.json():l.text()}export const ai={chat:chat,web:web};export async function search({q:t="",page:e=1,limit:n=50,tags:s=[],category:c="",format:o="json"}={}){const l=Array.isArray(s)&&s.length?s.join(","):String(s||"");return gamesRequest("/api/games",{q:t,page:e,limit:n,tags:l,category:c},o)}export async function popular({page:t=1,limit:e=20,format:n="json"}={}){const o=await gamesRequest("/api/games/remote",{page:t,limit:e},"json");return"json"===n?o:JSON.stringify(o,null,2)}export async function info({q:t="",format:e="json"}={}){const n=await gamesRequest("/api/games/remote",{q:t,page:1,limit:1},"json"),o=n&&n.items&&n.items[0]?n.items[0]:null;return"json"!==e?JSON.stringify(o,null,2):o}export function viewUrl(t){if(!t)throw new Error("md5 is required");return buildUrl(`/api/games/play/${encodeURIComponent(t)}`)}export const games={search:search,popular:popular,info:info,viewUrl:viewUrl};export async function check({text:t,format:e="json"}={}){if(!t)throw new Error("text is required");return filterRequest("/api/filter/check",{text:t},e)}export async function checkWithType({text:t,type:e,format:n="json"}={}){if(!t||!e)throw new Error("text and type are required");return filterRequest("/api/filter/check",{text:t,type:e},n)}export async function checkDomain({domain:t,blocker:e="",format:n="json"}={}){if(await ensureAuth("filter"),!t)throw new Error("domain is required");const o=e?`/api/filter-check/${encodeURIComponent(e)}`:"/api/filter-check",r=new URL(o,API_BASE);r.searchParams.set("url",String(t)),r.searchParams.set("format",n);const a="undefined"!=typeof globalThis&&globalThis.NEXTDEV_SDK_TOKEN?String(globalThis.NEXTDEV_SDK_TOKEN):null,i=a||__tokens.filter,s={Accept:"json"===n?"application/json":"text/plain"};i&&(s["X-SDK-Auth"]=i);const c=await fetch(r.toString(),{headers:s});if(!c.ok){const t=await c.text().catch(()=>"");throw new Error(`Filter domain failed ${c.status}: ${t}`)}return"json"===n?c.json():c.text()}export const filter={check:check,checkWithType:checkWithType,checkDomain:checkDomain};
//-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
