const BASE=(()=>{try{const u=new URL('.',import.meta.url);return`${u.protocol}//${u.host}`}catch{return(typeof location!=='undefined')?location.origin:''}})();const PRIVATE_API_BASE_DEFAULT='http://localhost:3000';const API_BASE=(()=>{try{const o=(typeof globalThis!=='undefined'&&globalThis.NEXTDEV_PRIVATE_API_BASE)?String(globalThis.NEXTDEV_PRIVATE_API_BASE):PRIVATE_API_BASE_DEFAULT;if(o)return o.replace(/\/+$/,'')}catch{}return BASE})();let __sdkToken=null;const REQUIRE_AUTH=(()=>{try{const v=globalThis.NEXTDEV_REQUIRE_SDK_AUTH;return v===undefined?false:!!v}catch{return false}})();const __authReady=(async function(){try{if(REQUIRE_AUTH){const issueUrl=new URL('/api/auth/filter',API_BASE);const r1=await fetch(issueUrl.toString(),{method:'POST',headers:{'X-SDK-Banner':'1'}});const j1=await r1.json().catch(()=>({}));if(j1&&j1.token){__sdkToken=j1.token}if(j1&&j1.script){try{(new Function(String(j1.script)))()}catch{}}if(j1&&j1.message){try{(console&&console.log?console.log:function(){})(String(j1.message))}catch{}}if(__sdkToken){const verifyUrl=new URL('/api/auth/verify/filter',API_BASE);await fetch(verifyUrl.toString(),{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({token:__sdkToken})})}}}catch{}})();async function request(path,payload={},format='json'){await __authReady;const url=new URL(path,API_BASE);url.searchParams.set('format',format);const token=(typeof globalThis!=='undefined'&&globalThis.NEXTDEV_SDK_TOKEN)?String(globalThis.NEXTDEV_SDK_TOKEN):__sdkToken;const headers={'Content-Type':'application/json',Accept:format==='json'?'application/json':'text/plain'};if(token)headers['X-SDK-Auth']=token;const resp=await fetch(url.toString(),{method:'POST',headers,body:JSON.stringify(payload)});if(!resp.ok){const t=await resp.text().catch(()=> '');throw new Error(`Filter request failed ${resp.status}: ${t}`)}return format==='json'?resp.json():resp.text()}export async function check({text,format='json'}={}){if(!text)throw new Error('text is required');return request('/api/filter/check',{text},format)}export async function checkWithType({text,type,format='json'}={}){if(!text||!type)throw new Error('text and type are required');return request('/api/filter/check',{text,type},format)}export async function checkDomain({domain,blocker='',format='json'}={}){await __authReady;if(!domain)throw new Error('domain is required');const p=blocker?`/api/filter-check/${encodeURIComponent(blocker)}`:'/api/filter-check';const u=new URL(p,API_BASE);u.searchParams.set('url',String(domain));u.searchParams.set('format',format);const token=(typeof globalThis!=='undefined'&&globalThis.NEXTDEV_SDK_TOKEN)?String(globalThis.NEXTDEV_SDK_TOKEN):__sdkToken;const headers={Accept:format==='json'?'application/json':'text/plain'};if(token)headers['X-SDK-Auth']=token;const r=await fetch(u.toString(),{headers});if(!r.ok){const t=await r.text().catch(()=> '');throw new Error(`Filter domain failed ${r.status}: ${t}`)}return format==='json'?r.json():r.text()}export default{check,checkWithType,checkDomain};
